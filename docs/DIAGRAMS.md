# Dulce de Saigon Architecture Diagrams

## System Architecture

```mermaid
flowchart TD
    A[Web Client] -->|HTTP/REST| B[API Service]
    B -->|Publish| C[PUB/SUB TOPICS]
    C --> D[INGEST WORKER]
    D --> E[BIGQUERY]
    C --> F[AGENTS WORKER]
    F --> E
    F -->|Vertex AI| G[AI INSIGHTS]
    H[EXTERNAL SYSTEMS] -->|API| B
    I[CLOUD STORAGE] -->|Backup| J[BACKUP STORAGE]
    
    subgraph GCP
        B
        C
        D
        E
        F
        G
        I
        J
    end
    
    subgraph CLIENTS
        A
        H
    end
```

## Data Flow Diagram

```mermaid
sequenceDiagram
    participant User
    participant WebApp
    participant API
    participant PubSub
    participant IngestWorker
    participant BigQuery
    participant AgentsWorker
    participant VertexAI
    
    User->>WebApp: Interacts with website
    WebApp->>API: Send events
    API->>PubSub: Publish to events topic
    PubSub->>IngestWorker: Consume events
    IngestWorker->>BigQuery: Store raw events
    API-->>User: Return response
    
    AgentsWorker->>PubSub: Consume from agents topic
    AgentsWorker->>VertexAI: Request AI insights
    VertexAI-->>AgentsWorker: Return insights
    AgentsWorker->>BigQuery: Store agent runs
```

## Infrastructure Diagram

```mermaid
graph LR
    A[Cloud Run - API] --> B[PUB/SUB]
    C[Cloud Run - Agents] --> B
    B --> D[BigQuery]
    C --> E[Vertex AI]
    F[Cloud Storage] --> G[Backup]
    H[Secret Manager] --> A
    H --> C
    
    subgraph Google Cloud
        A
        B
        C
        D
        E
        F
        G
        H
    end
```

## Component Interaction Diagram

```mermaid
graph TD
    A[Web Application] -->|REST API| B[API Service]
    B -->|Publish| C[PUB/SUB Events Topic]
    C --> D[Ingest Worker]
    D --> E[BigQuery Events Table]
    B -->|Publish| F[PUB/SUB Agents Topic]
    F --> G[Agents Worker]
    G --> H[BigQuery Agent Runs Table]
    G --> I[Vertex AI]
    J[External Systems] -->|API| B
    K[Cloud Storage] --> L[Backup Storage]
    
    subgraph Frontend
        A
    end
    
    subgraph Backend
        B
        C
        D
        E
        F
        G
        H
        I
    end
    
    subgraph External
        J
        K
        L
    end
```

## Authentication Flow

```mermaid
sequenceDiagram
    participant User
    participant WebApp
    participant OAuth
    participant API
    participant IAM
    
    User->>WebApp: Access website
    WebApp->>OAuth: Redirect to login
    OAuth-->>User: Show login page
    User->>OAuth: Enter credentials
    OAuth-->>WebApp: Return auth code
    WebApp->>API: Request with auth code
    API->>IAM: Validate with service account
    IAM-->>API: Return validation
    API-->>WebApp: Return data
```

## CI/CD Pipeline

```mermaid
graph LR
    A[GitHub] --> B[Workload Identity Federation]
    B --> C[Cloud Build]
    C --> D[Test Suite]
    D --> E[Security Scan]
    E --> F[Build Container]
    F --> G[Deploy to Cloud Run]
    
    subgraph Development
        A
    end
    
    subgraph Google Cloud
        B
        C
        D
        E
        F
        G
    end
```

## Data Schema Diagram

```mermaid
erDiagram
    EVENTS ||--o{ AGENT_RUNS : "generated by"
    AGENT_RUNS ||--o{ AI_INSIGHTS : "processed by"
    
    EVENTS {
        string id
        string type
        timestamp ts
        json payload
    }
    
    AGENT_RUNS {
        string id
        timestamp ts
        string task
        string[] tools_used
        string result
        json raw
    }
    
    AI_INSIGHTS {
        string id
        timestamp ts
        string insight_type
        json data
        string agent_run_id
    }
```

## Network Architecture

```mermaid
graph TD
    A[Internet] --> B[Cloud Load Balancer]
    B --> C[Cloud Run API Service]
    B --> D[Cloud Run Web Service]
    C --> E[VPC Network]
    D --> E
    E --> F[Cloud SQL]
    E --> G[Cloud Storage]
    E --> H[Secret Manager]
    
    subgraph Google Cloud
        B
        C
        D
        E
        F
        G
        H
    end
    
    subgraph Services
        C
        D
        F
        G
        H
    end
```

## Monitoring and Logging

```mermaid
graph TD
    A[Application Logs] --> B[Cloud Logging]
    C[Infrastructure Metrics] --> D[Cloud Monitoring]
    E[Security Events] --> F[Security Command Center]
    B --> G[Log Analysis]
    D --> H[Performance Dashboard]
    F --> I[Security Dashboard]
    
    subgraph Data Sources
        A
        C
        E
    end
    
    subgraph Google Cloud Services
        B
        D
        F
    end
    
    subgraph Analysis
        G
        H
        I
    end
```

## Backup and Disaster Recovery

```mermaid
graph TD
    A[Production Environment] --> B[Cloud Storage Backup]
    A --> C[BigQuery Snapshots]
    D[Disaster Recovery Plan] --> E[Restore Procedures]
    E --> F[Testing Schedule]
    B --> G[Cross-Region Replication]
    C --> G
    
    subgraph Production
        A
    end
    
    subgraph Backup
        B
        C
        G
    end
    
    subgraph Recovery
        D
        E
        F
    end
```

## Vietnamese Localization Flow

```mermaid
graph TD
    A[Content Creation] --> B[Vietnamese Translation]
    B --> C[Cultural Adaptation]
    C --> D[Quality Assurance]
    D --> E[Deployment]
    E --> F[User Feedback]
    F --> A
    
    subgraph Localization Process
        A
        B
        C
        D
        E
        F
    end
```

## Payment Processing Flow

```mermaid
sequenceDiagram
    participant Customer
    participant WebApp
    participant API
    participant PaymentGateway
    participant Bank
    
    Customer->>WebApp: Initiate payment
    WebApp->>API: Process payment request
    API->>PaymentGateway: Forward payment details
    PaymentGateway->>Bank: Process transaction
    Bank-->>PaymentGateway: Return result
    PaymentGateway-->>API: Return response
    API-->>WebApp: Confirm payment
    WebApp-->>Customer: Show confirmation
```

## Conclusion

These diagrams provide a visual representation of the Dulce de Saigon platform architecture, data flows, and infrastructure. They help illustrate how different components interact with each other and how data moves through the system. The diagrams are designed to be easily understandable by both technical and non-technical stakeholders.